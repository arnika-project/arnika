name: arnika-ci-test

topology:
  nodes:
    qkd-simulator:
      kind: linux
      image: qkd-simulator:ci
      exec:
      - bash -lc 'ip addr add 192.168.100.1/30 dev eth1 && ip link set eth1 up'
      - bash -lc 'ip addr add 192.168.101.1/30 dev eth2 && ip link set eth2 up'

    node-a:
      kind: linux
      image: arnika-node:ci
      binds:
      - ./node-a:/etc/arnika
      ## race condition generator -> enable this block to enforce race condition
      #stages:
      #  configure:
      #    exec:
      #    - command: containerlab tools netem set -n clab-arnika-ci-test-node-a -i eth2 --delay 1s
      #      target: host
      exec:
      - bash -lc 'ip addr add 192.168.100.2/30 dev eth1 && ip link set eth1 up'
      - bash -lc 'ip addr add 10.0.0.1/30 dev eth2 && ip link set eth2 up'

    node-b:
      kind: linux
      image: arnika-node:ci
      binds:
      - ./node-b:/etc/arnika
      exec:
      - bash -lc 'ip addr add 192.168.101.2/30 dev eth1 && ip link set eth1 up'
      - bash -lc 'ip addr add 10.0.0.2/30 dev eth2 && ip link set eth2 up'

  links:
  - endpoints:
    - qkd-simulator:eth1
    - node-a:eth1
  - endpoints:
    - qkd-simulator:eth2
    - node-b:eth1
  - endpoints:
    - node-a:eth2
    - node-b:eth2
